"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9001],{9001:(A,M,r)=>{r.r(M),r.d(M,{GoForRunPageModule:()=>F});var Z=r(6814),T=r(95),a=r(1929),f=r(335),m=r(5861),h=r(7838),t=r(6689),R=r(9862),k=r(9682);const w=[{path:"",component:(()=>{var i;class l{constructor(e,o,n){this.http=e,this.authService=o,this.router=n,this.startTime=null,this.totalDistance=0,this.previousPosition=null,this.timer=null,this.elapsedTime="00:00:00",this.diff=0,this.startLocation=null,this.distanceFromStart=0}ngOnInit(){this.authService.getCurrentUser().subscribe(e=>{console.log(e||"User is not signed in")}),this.loadMap(),this.setCurrentPosition()}loadMap(){const o=document.getElementById("map");o?this.map=new google.maps.Map(o,{center:{lat:-34.397,lng:150.644},zoom:15}):console.error("Map element not found")}setCurrentPosition(){var e=this;return(0,m.Z)(function*(){try{const o=yield h.b.getCurrentPosition({enableHighAccuracy:!0});console.log("Current Position: ",o);const n=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);e.map&&(e.userMarker=new google.maps.Marker({position:n,map:e.map,title:"Your Location"}),e.map.setCenter(n))}catch(o){console.error("Could not get current position",o)}})()}startTracking(){var e=this;return(0,m.Z)(function*(){try{const o=yield h.b.getCurrentPosition();console.log("Start tracking position: ",o);const n=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),s=e.generateCircularPathWaypoints(n,e.selectedRunDistance/4),c=yield e.getDirections(n,s);if(e.map&&null!==c&&c.routes&&c.routes.length>0){const d=new google.maps.Polyline({path:c.routes[0].overview_path,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});d.setMap(e.map),new google.maps.Marker({position:n,map:e.map,title:"Start"});const u=new google.maps.LatLngBounds;d.getPath().forEach(p=>{u.extend(p)}),e.map.fitBounds(u)}else console.error("Map or directions data is not available.")}catch(o){console.error("Could not start tracking",o)}yield e.setStartLocation()})()}beginRun(){this.startLiveTracking(),this.startTime=new Date,this.startTimer()}generateCircularPathWaypoints(e,o){const n=[],s=o/6371,c=e.lat()*(Math.PI/180),d=e.lng()*(Math.PI/180),u=Math.ceil(2*Math.PI*6371*s);for(let p=0;p<u;p++){const v=p/u*(2*Math.PI),P=Math.asin(Math.sin(c)*Math.cos(s)+Math.cos(c)*Math.sin(s)*Math.cos(v)),y=d+Math.atan2(Math.sin(v)*Math.sin(s)*Math.cos(c),Math.cos(s)-Math.sin(c)*Math.sin(P));n.push({location:new google.maps.LatLng(P*(180/Math.PI),y*(180/Math.PI)),stopover:!0})}return n}getDirections(e,o){return(0,m.Z)(function*(){return new Promise((n,s)=>{(new google.maps.DirectionsService).route({origin:e,waypoints:o,destination:e,travelMode:google.maps.TravelMode.WALKING,optimizeWaypoints:!0},(d,u)=>{u===google.maps.DirectionsStatus.OK?n(d):s(new Error(`Directions request failed due to ${u}`))})})})()}calculateDestination(e,o){const n=e.lat()+o/111.32,s=e.lng()+o/(111.32*Math.cos(e.lat()*(Math.PI/180)));return new google.maps.LatLng(n,s)}startLiveTracking(){this.watchId=h.b.watchPosition({maximumAge:0,timeout:5e3,enableHighAccuracy:!0},(o,n)=>{o?(console.log("Live tracking position: ",o),this.updateUserMarkerPosition(o)):n&&console.error("Error watching position:",n)})}updateUserMarkerPosition(e){console.log("Updating position");const o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.startLocation&&(this.distanceFromStart=google.maps.geometry.spherical.computeDistanceBetween(this.startLocation,o)),this.previousPosition&&(this.totalDistance+=google.maps.geometry.spherical.computeDistanceBetween(this.previousPosition,o)),this.previousPosition=o,this.userMarker&&this.map?(this.userMarker.setPosition(o),this.map.panTo(o)):this.map&&(this.userMarker=new google.maps.Marker({position:o,map:this.map,title:"Your Location"}))}calculatePace(){if(!this.startTime)return"0.00";const o=((new Date).getTime()-this.startTime.getTime())/1e3,n=this.totalDistance/1e3;return 0===n?"0.00":(o/60/n).toFixed(2)}startTimer(){this.timer=setInterval(()=>{var e;const o=new Date,n=o.getTime()-((null===(e=this.startTime)||void 0===e?void 0:e.getTime())||o.getTime());this.elapsedTime=this.formatTime(n)},1e3)}formatTime(e){let o=Math.floor(e/1e3),n=Math.floor(o/60),s=Math.floor(n/60);return o%=60,n%=60,`${this.pad(s)}:${this.pad(n)}:${this.pad(o)}`}pad(e){return e<10?`0${e}`:e.toString()}setStartLocation(){var e=this;return(0,m.Z)(function*(){const o=yield h.b.getCurrentPosition();e.startLocation=new google.maps.LatLng(o.coords.latitude,o.coords.longitude)})()}formatDistance(e){return(e/1e3).toFixed(2)}stopLiveTracking(){null!=this.watchId&&h.b.clearWatch({id:this.watchId})}stopRun(){this.stopLiveTracking(),this.timer&&(clearInterval(this.timer),this.timer=null),this.diff=this.startTime?(new Date).getTime()-this.startTime.getTime():0,this.calculatePace()}goBack(){this.router.navigate(["/exercises"])}}return(i=l).\u0275fac=function(e){return new(e||i)(t.Y36(R.eN),t.Y36(k.e),t.Y36(f.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-go-for-run"]],decls:60,vars:7,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],["id","map",2,"height","50%"],[3,"ngModel","ngModelChange"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","10"],[1,"button-container"],[1,"map-run-button",3,"click"],[1,"start-run-button",3,"click"],[1,"end-run-button",3,"click"],[3,"click"],["size","6"],[1,"custom-card"],[1,"center-content"],["size","12"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"goForRun"),t.qZA()()(),t.TgZ(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),t._uU(8,"goForRun"),t.qZA()()(),t.TgZ(9,"ion-content",1),t._UZ(10,"div",4),t.TgZ(11,"ion-item")(12,"ion-label"),t._uU(13,"Select Run Distance (km)"),t.qZA(),t.TgZ(14,"ion-select",5),t.NdJ("ngModelChange",function(s){return o.selectedRunDistance=s}),t.TgZ(15,"ion-select-option",6),t._uU(16,"1"),t.qZA(),t.TgZ(17,"ion-select-option",7),t._uU(18,"2"),t.qZA(),t.TgZ(19,"ion-select-option",8),t._uU(20,"3"),t.qZA(),t.TgZ(21,"ion-select-option",9),t._uU(22,"4"),t.qZA(),t.TgZ(23,"ion-select-option",10),t._uU(24,"5"),t.qZA(),t.TgZ(25,"ion-select-option",11),t._uU(26,"10"),t.qZA()()(),t.TgZ(27,"div",12)(28,"ion-button",13),t.NdJ("click",function(){return o.startTracking()}),t._uU(29,"Map Run"),t.qZA(),t.TgZ(30,"ion-button",14),t.NdJ("click",function(){return o.beginRun()}),t._uU(31,"Start Run"),t.qZA(),t.TgZ(32,"ion-button",15),t.NdJ("click",function(){return o.stopRun()}),t._uU(33,"End Run"),t.qZA(),t.TgZ(34,"ion-button",16),t.NdJ("click",function(){return o.goBack()}),t._uU(35,"Go back"),t.qZA()(),t.TgZ(36,"ion-grid")(37,"ion-row")(38,"ion-col",17)(39,"ion-card",18)(40,"ion-card-content",19)(41,"ion-card-title"),t._uU(42,"Average Pace (min/km)"),t.qZA(),t.TgZ(43,"ion-card-subtitle"),t._uU(44),t.qZA()()()(),t.TgZ(45,"ion-col",17)(46,"ion-card",18)(47,"ion-card-content",19)(48,"ion-card-title"),t._uU(49,"Time Elapsed"),t.qZA(),t.TgZ(50,"ion-card-subtitle"),t._uU(51),t.qZA()()()()(),t.TgZ(52,"ion-row")(53,"ion-col",20)(54,"ion-card",18)(55,"ion-card-content",19)(56,"ion-card-title"),t._uU(57,"Distance from Start (km)"),t.qZA(),t.TgZ(58,"ion-card-subtitle"),t._uU(59),t.qZA()()()()()()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(4),t.Q6J("fullscreen",!0),t.xp6(5),t.Q6J("fullscreen",!0),t.xp6(5),t.Q6J("ngModel",o.selectedRunDistance),t.xp6(30),t.Oqu(o.calculatePace()),t.xp6(7),t.Oqu(o.elapsedTime),t.xp6(8),t.Oqu(o.formatDistance(o.distanceFromStart)))},dependencies:[T.JJ,T.On,a.YG,a.PM,a.FN,a.tO,a.Dq,a.wI,a.W2,a.jY,a.Gu,a.Ie,a.Q$,a.Nd,a.t9,a.n0,a.wd,a.sr,a.QI]}),l})()}];let L=(()=>{var i;class l{}return(i=l).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[f.Bz.forChild(w),f.Bz]}),l})(),F=(()=>{var i;class l{}return(i=l).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[Z.ez,T.u5,a.Pc,L]}),l})()}}]);